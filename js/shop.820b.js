var CookieModel=Backbone.Model.extend({initialize:function(){this.fetch()},fetch:function(){this.set($.parseJSON($.cookie(this.id)))},save:function(a){this.set(a),$.cookie(this.id,JSON.stringify(this.toJSON()))},destroy:function(){$.removeCookie(this.id)},isEmpty:function(){return _.size(this.attributes)<=1}}),CookieBanner=Backbone.View.extend({events:{"click .close":"_onClickClose"},render:function(){return this.$el[this.model.isEmpty()?"show":"hide"](),this},_onClickClose:function(a){a.preventDefault(),this.$el.hide(),this.model.save({"merceria-alonso":!0})}}),LocationMap=Backbone.View.extend({defaults:{center:new google.maps.LatLng(40.474139,-3.872835)},initialize:function(){this._initBinds()},render:function(){this.$el.append($("<div>").attr("id","map"));var a={zoom:18,center:this.defaults.center,disableDefaultUI:!0,disableDoubleClickZoom:!0,draggable:!1,scrollwheel:!1};return this.map=new google.maps.Map(this.$("#map")[0],a),this._addPolygon(),this._onResize(),this},_initBinds:function(){_.bindAll(this,"_onResize"),$(window).on("resize",this._onResize)},_addPolygon:function(){this.map.data.addGeoJson({type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-3.873039,40.47415],[-3.873043,40.47409],[-3.872883,40.474087],[-3.872903,40.474259],[-3.872978,40.47426],[-3.872987,40.474142],[-3.873039,40.47415]]]]}});var a={fillColor:"#00B285",fillOpacity:.7,strokeWeight:1.5,strokeColor:"#666"};this.map.data.setStyle(a)},_onResize:function(){this.map.setCenter(this.defaults.center),$(window).width()<569?(this.$el.addClass("padtop"),this.map.panBy(-30,130)):(this.map.panBy(200,0),this.$el.removeClass("padtop"))}});$(function(){var a=Backbone.View.extend({events:{"click a[href*=#]:not([href=#])":"_scrollTo","click .header-comp-nav":"_changeActive",click:"_removeActive"},initialize:function(a){this.options=a,this.model=new Backbone.Model({active:!1}),this.cookie=new CookieModel({id:"merceria-alonso"}),this._initViews(),this._initBinds()},_initViews:function(){var a=new LocationMap({el:this.$("#localizacion")});a.render();var b=new CookieBanner({el:this.$(".cookie-banner"),model:this.cookie});b.render()},_initBinds:function(){this.model.bind("change:active",this._onActiveChange,this)},_onActiveChange:function(){var a=this.model.get("active");this.$el[a?"addClass":"removeClass"]("active")},_changeActive:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.model.set("active",!this.model.get("active"))},_removeActive:function(){this.model.set("active",!1)},_scrollTo:function(a){var b=$(a.target).attr("href");if(b&&0===b.search("#")&&-1===b.search("#/")){a&&(a.preventDefault(),a.stopPropagation());var c=$(b);if(c=c.length?c:this.$("[name="+b.slice(1)+"]"),c.length)return $("html,body").animate({scrollTop:c.offset().top},1e3),!1}}});window.shop=new a({el:document.body})});